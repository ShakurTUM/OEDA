<div class="row" *ngIf="dataAvailable">
  <!-- Experiment Details -->
  <experiment-details [experiment]="experiment"
                      [is_collapsed]="is_collapsed"
                      [targetSystem]="targetSystem"
                      [for_successful_experiment]="false"
                      [oedaCallback]="oedaCallback"
                      (enable_polling_btn_clicked)="enable_polling($event)"
                      (disable_polling_btn_clicked)="disable_polling($event)"
                      (stop_experiment_btn_clicked)="stopRunningExperiment($event)"></experiment-details>

  <!-- Experiment Stages with paginator -->
  <experiment-stages-paginator [experiment]="experiment"
                               [selected_stage]="selected_stage"
                               [available_stages]="available_stages"
                               [incoming_data_type]="incoming_data_type"
                               [scale]="scale"
                               [targetSystem]="targetSystem"
                               [for_successful_experiment]="false"
                               [hidden]="false"
                               (incomingDataTypeChanged)="incoming_data_type_changed($event)"
                               (scaleChanged)="scale_changed($event)"
                               (rowClicked)="stage_changed($event)"></experiment-stages-paginator>

  <!--Status (Callback) Info-->
  <div class="col-md-12" *ngIf="targetSystem.name !== ''">
      <div class="panel panel-default chartJs">
        <div class="panel-body" style="padding-top: 20px">
          <h3>Current Status of Experiment</h3>
          <div *ngIf="oedaCallback['status'] !== 'IGNORING_SAMPLES' && oedaCallback['status'] !== 'COLLECTING_DATA' && oedaCallback['status'] !== 'EXPERIMENT_STAGE_DONE'">
            <i class="fa fa-spinner fa-pulse fa-3x fa-fw" style="padding-top: 1%"></i>
            <h4>Please wait...</h4>
          </div>
          <div *ngIf="oedaCallback['status'] === 'IGNORING_SAMPLES'">
            <h4 *ngIf="oedaCallback['remaining_time_and_stages']['remaining_stages'] !== undefined && oedaCallback['remaining_time_and_stages']['remaining_time'] !== undefined">
              Remaining number of stages: {{oedaCallback['remaining_time_and_stages']['remaining_stages']}}, estimated remaining time: {{oedaCallback['remaining_time_and_stages']['remaining_time']}} seconds
            </h4>
            <h4>
              Ignoring samples for <b>stage {{oedaCallback['stage_counter']}}</b>
            </h4>
            <h4 *ngIf="experiment.executionStrategy.type !== 'forever'">
              Configuration:
            </h4>
            <ul *ngIf="experiment.executionStrategy.type !== 'forever'">
              <li *ngFor="let key of get_keys(oedaCallback.current_knob)"><b>{{key}}:</b> {{oedaCallback.current_knob[key]}}</li>
            </ul>
            <p>
              Number of ignored samples: {{oedaCallback['index']}} , total size: {{oedaCallback['size']}}
            </p>
            <progressbar [value]="oedaCallback['complete']*100"></progressbar>
          </div>

          <div *ngIf="oedaCallback['status'] === 'COLLECTING_DATA' || oedaCallback['status'] === 'EXPERIMENT_STAGE_DONE'">
            <h4 *ngIf="oedaCallback['remaining_time_and_stages']['remaining_stages'] != null && oedaCallback['remaining_time_and_stages']['remaining_time'] != null">
              Remaining number of stages: {{oedaCallback['remaining_time_and_stages']['remaining_stages']}}, estimated remaining time: {{oedaCallback['remaining_time_and_stages']['remaining_time']}} seconds
            </h4>
            <h4>
              Collecting data for  <b>stage {{oedaCallback['stage_counter']}}</b>
            </h4>
            <h4 *ngIf="experiment.executionStrategy.type !== 'forever'">
              Configuration:
            </h4>
            <ul *ngIf="experiment.executionStrategy.type !== 'forever'">
              <li *ngFor="let key of get_keys(oedaCallback.current_knob);"><b>{{key}}:</b> {{oedaCallback.current_knob[key]}}</li>
            </ul>
            <p>
              Number of collected data: {{oedaCallback['index']}} , total size: {{oedaCallback['size']}}
            </p>
            <progressbar [value]="oedaCallback['complete']*100"></progressbar>
          </div>
          <div *ngIf="oedaCallback['remaining_stages'] === 0">
            <h4>
              Experiment is completed with {{oedaCallback['experiment_counter']}} stages...
            </h4>
          </div>

        </div>
      </div>
  </div>

  <!-- Scatter Plot -->
  <div class="col-md-12" [hidden]="!is_enough_data_for_plots">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="card-title">
          <div class="title pull-left">Scatter Plot with {{scale}} Scale</div>
        </div>
      </div>
      <div class="panel-body">
        <div class="col-md-12" id="chartdiv" style="width: 100%; height: 400px"></div>
      </div>
      <div class="panel-footer">
        <p id="filterSummary">Threshold for 95-percentile: <b>{{initial_threshold_for_scatter_plot}}</b>, number of points to be filtered: {{nr_points_to_be_filtered}}</p>
        <!--<button id="filterButton{{selected_stage.number}}" type="button" class="btn btn-primary" (click)="filter_outliers($event)">Filter</button>-->
      </div>
    </div>
  </div>

  <!-- Histogram -->
  <div class="col-md-12" [hidden]="!is_enough_data_for_plots">
    <div class="panel panel-default">
        <div class="panel-heading">
          <div class="card-title">
            <div class="title pull-left">Histogram with {{scale}} Scale</div>
        </div>
      </div>
      <div class="panel-body" >
        <div class="col-md-12" id="histogram" style="width: 100%; height: 400px"></div>
      </div>
    </div>
  </div>

  <debug-element [element]="targetSystem"></debug-element>
</div>
